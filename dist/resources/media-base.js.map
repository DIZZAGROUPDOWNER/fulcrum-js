{"version":3,"sources":["../../src/resources/media-base.js"],"names":["require","MediaResource","file","attributes","attrs","formData","append","resourceName","access_key","v4","body","options","optionsForUpload","Object","assign","client","api","postMedia","createAction","accessKey","version","find","media","fetch","then","resp","callback","streamVersion","includeInto"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AAIA;;;;AACA;;;;AACA;;;;AACA;;;;;;AANA;AACAA,QAAQ,gBAAR;;IAOqBC,a;;;;;;;;;;qCACFC,I,EAAMC,U,EAAY;AACjC,UAAMC,QAAQD,cAAc,EAA5B;AACA,UAAME,WAAW,wBAAjB;;AAEAA,eAASC,MAAT,CAAmB,KAAKC,YAAxB,mBAAoDH,MAAMI,UAAN,IAAoB,eAAKC,EAAL,EAAxE;AACAJ,eAASC,MAAT,CAAmB,KAAKC,YAAxB,aAA8CL,IAA9C;;AAEA,aAAO;AACLQ,cAAML;AADD,OAAP;AAGD;;;;2GAEYH,I,EAAMC,U;;;;;;AACXQ,uB,GAAU,KAAKC,gBAAL,CAAsBV,IAAtB,EAA4BC,UAA5B,C;;;AAEhBU,uBAAOC,MAAP,CAAcH,OAAd,EAAuB,KAAKI,MAAL,CAAYC,GAAZ,CAAgBL,OAAvC;;;uBAEmB,KAAKI,MAAL,CAAYC,GAAZ,CAAgBC,SAAhB,CAA0B,KAAKC,YAA/B,EAA6CP,OAA7C,C;;;AAAbD,oB;iDAECA,KAAK,KAAKH,YAAV,C;;;;;;;;;;;;;;;;;;;6GAGWY,S,EAAWC,O;;;;;;;uBACT,KAAKC,IAAL,CAAUF,SAAV,C;;;AAAdG,qB;kDACCC,MAAMD,MAAMF,OAAN,CAAN,EACJI,IADI,CACC;AAAA,yBAAQC,KAAKf,IAAb;AAAA,iBADD,C;;;;;;;;;;;;;;;;;;mCAIMS,S,EAAWO,Q,EAAU;AAClC,aAAO,KAAKC,aAAL,CAAmBR,SAAnB,EAA8B,UAA9B,CAAP;AACD;;;;;kBA/BkBlB,a;;;AAkCrB,eAAK2B,WAAL,CAAiB3B,aAAjB;AACA,eAAK2B,WAAL,CAAiB3B,aAAjB;AACA,iBAAO2B,WAAP,CAAmB3B,aAAnB","file":"media-base.js","sourcesContent":["import uuid from 'uuid';\nimport FormData from 'form-data';\n// import fetch from 'isomorphic-fetch';\nrequire('portable-fetch');\n\nimport List from '../actions/list';\nimport Find from '../actions/find';\nimport Create from '../actions/create';\nimport Resource from './base';\n\nexport default class MediaResource extends Resource {\n  optionsForUpload(file, attributes) {\n    const attrs = attributes || {};\n    const formData = new FormData();\n\n    formData.append(`${this.resourceName}[access_key]`, attrs.access_key || uuid.v4());\n    formData.append(`${this.resourceName}[file]`, file);\n\n    return {\n      body: formData\n    };\n  }\n\n  async create(file, attributes) {\n    const options = this.optionsForUpload(file, attributes);\n\n    Object.assign(options, this.client.api.options);\n\n    const body = await this.client.api.postMedia(this.createAction, options);\n\n    return body[this.resourceName];\n  }\n\n  async streamVersion(accessKey, version) {\n    const media = await this.find(accessKey);\n    return fetch(media[version])\n      .then(resp => resp.body);\n  }\n\n  streamOriginal(accessKey, callback) {\n    return this.streamVersion(accessKey, 'original');\n  }\n}\n\nList.includeInto(MediaResource);\nFind.includeInto(MediaResource);\nCreate.includeInto(MediaResource);\n"]}